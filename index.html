<!DOCTYPE html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô üéì</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Prompt', sans-serif;
      box-sizing: border-box;
    }
    * {
      box-sizing: border-box;
    }
    body {
      box-sizing: border-box;
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .animate-slide-up { animation: slideUp 0.5s ease-out; }
    .animate-pulse-btn { animation: pulse 0.5s ease-out; }
    .glass {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .hidden-page {
      display: none !important;
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Prompt', sans-serif;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }
    .btn-primary:active {
      transform: scale(0.98);
    }
    .btn-success {
      background: #10b981;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Prompt', sans-serif;
    }
    .btn-success:hover {
      background: #059669;
    }
    .btn-danger {
      background: #ef4444;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Prompt', sans-serif;
    }
    .btn-danger:hover {
      background: #dc2626;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      z-index: 9999;
      animation: slideUp 0.3s ease-out;
      max-width: 400px;
    }
    .notification.success {
      border-left: 4px solid #10b981;
    }
    .notification.error {
      border-left: 4px solid #ef4444;
    }
    input, textarea, select {
      font-family: 'Prompt', sans-serif !important;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      border-left: 4px solid #667eea;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
    }
    .badge-pending {
      background: #fef3c7;
      color: #92400e;
    }
    .badge-approved {
      background: #d1fae5;
      color: #065f46;
    }
    .badge-rejected {
      background: #fee2e2;
      color: #7f1d1d;
    }
    .spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="h-full w-full bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 overflow-auto">
  <div id="app" class="min-h-full w-full">

    <!-- üîê LOGIN PAGE -->
    <div id="loginPage" class="w-full min-h-full flex items-center justify-center p-4">
      <div class="w-full max-w-md animate-slide-up">
        <div class="glass rounded-3xl p-8 shadow-2xl">
          <div class="text-center mb-8">
            <div style="font-size: 80px; margin-bottom: 16px; animation: pulse 2s ease-in-out infinite;">üë®‚Äçüéì</div>
            <h1 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô</h1>
            <p class="text-gray-600 text-base">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
          </div>

          <div class="space-y-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">üé´ ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
              <input type="text" id="studentId" placeholder="‡πÄ‡∏ä‡πà‡∏ô 12345" class="w-full px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 focus:ring-2 focus:ring-purple-200 transition-all" />
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">ü™™ ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢)</label>
              <input type="text" id="nationalId" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1234" maxlength="4" class="w-full px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 focus:ring-2 focus:ring-purple-200 transition-all" />
            </div>

            <button class="btn-primary w-full text-lg" onclick="studentLogin()">üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>

            <div class="relative my-6">
              <div class="absolute inset-0 flex items-center"><div class="w-full border-t-2 border-gray-300"></div></div>
              <div class="relative flex justify-center"><span class="px-3 bg-white text-gray-500 font-medium text-sm">‡∏´‡∏£‡∏∑‡∏≠</span></div>
            </div>

            <button class="w-full bg-white border-2 border-green-400 text-green-600 font-bold py-3 rounded-xl hover:bg-green-50 transition-all" onclick="showTeacherLoginPage()">üë®‚Äçüè´ ‡∏Ñ‡∏£‡∏π/‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
          </div>

          <div id="loginError" class="mt-4 p-4 bg-red-50 border-l-4 border-red-500 text-red-700 rounded-lg hidden animate-slide-up">
            <p class="font-semibold" id="loginErrorText">‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>
          </div>
        </div>
      </div>
    </div>

    <!-- üè´ TEACHER LOGIN PAGE -->
    <div id="teacherLoginPage" class="w-full min-h-full flex items-center justify-center p-4 hidden-page">
      <div class="w-full max-w-md animate-slide-up">
        <div class="glass rounded-3xl p-8 shadow-2xl">
          <div class="text-center mb-8">
            <div style="font-size: 80px; margin-bottom: 16px; animation: pulse 2s ease-in-out infinite;">üë®‚Äçüè´</div>
            <h1 class="text-4xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</h1>
            <p class="text-gray-600 text-base">‡∏Ñ‡∏£‡∏π / ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</p>
          </div>

          <div class="space-y-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
              <input type="text" id="teacherUsername" placeholder="admin" class="w-full px-4 py-3 border-2 border-green-300 rounded-xl focus:outline-none focus:border-green-600 focus:ring-2 focus:ring-green-200 transition-all" />
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">üîë ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
              <input type="password" id="teacherPassword" placeholder="1234" class="w-full px-4 py-3 border-2 border-green-300 rounded-xl focus:outline-none focus:border-green-600 focus:ring-2 focus:ring-green-200 transition-all" />
            </div>

            <button class="btn-primary w-full text-lg" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);" onclick="teacherLogin()">üîì ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>

            <button class="w-full bg-gray-100 border-2 border-gray-300 text-gray-700 font-bold py-3 rounded-xl hover:bg-gray-50 transition-all" onclick="backToStudentLogin()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>

            <div class="p-3 bg-blue-50 border-l-4 border-blue-500 text-blue-700 rounded-lg text-sm">
              <p class="font-semibold">üí° ‡∏ó‡∏î‡∏™‡∏≠‡∏ö: admin / 1234</p>
            </div>
          </div>

          <div id="teacherLoginError" class="mt-4 p-4 bg-red-50 border-l-4 border-red-500 text-red-700 rounded-lg hidden animate-slide-up">
            <p class="font-semibold" id="teacherLoginErrorText">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
          </div>
        </div>
      </div>
    </div>

    <!-- üë®‚Äçüéì STUDENT DASHBOARD -->
    <div id="studentDashboard" class="w-full min-h-full p-4 hidden-page">
      <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="glass rounded-2xl p-6 mb-6 shadow-lg animate-slide-up">
          <div class="flex items-center justify-between gap-4 flex-wrap">
            <div class="flex items-center gap-4">
              <div style="font-size: 60px;">üë®‚Äçüéì</div>
              <div>
                <p class="text-2xl font-bold text-gray-800">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</p>
                <p class="text-gray-600 text-sm">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß: <span id="stdIdDisplay" class="font-bold">-</span></p>
              </div>
            </div>
            <button class="btn-danger" onclick="logoutUser()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
          </div>
        </div>

        <!-- Tabs -->
        <div class="flex gap-2 mb-6">
          <button class="px-6 py-2 rounded-lg font-bold transition-all" id="tabRequest" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;" onclick="switchTab('request')">üìù ‡∏Ç‡∏≠‡∏•‡∏≤</button>
          <button class="px-6 py-2 rounded-lg font-bold transition-all bg-gray-200 text-gray-700" id="tabHistory" onclick="switchTab('history')">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
        </div>

        <!-- REQUEST FORM -->
        <div id="requestForm" class="glass rounded-2xl p-6 shadow-lg animate-slide-up">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">üìù ‡∏Ç‡∏≠‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô</h2>

          <div class="space-y-5">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üë§ ‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
                <input type="text" id="formName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏ô‡∏ß‡∏•‡∏®‡∏£‡∏µ" class="w-full px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all" />
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üè´ ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                <input type="text" id="formClass" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°.3/1" class="w-full px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all" />
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤</label>
                <input type="date" id="formDate" class="w-full px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all" />
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üïê ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</label>
                <input type="time" id="formTime" class="w-full px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all" />
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üïë ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                <input type="time" id="formTimeIn" class="w-full px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all" />
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üìã ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label>
                <select id="formReason" class="w-full px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all">
                  <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• --</option>
                  <option value="‡∏õ‡πà‡∏ß‡∏¢">üè• ‡∏õ‡πà‡∏ß‡∏¢</option>
                  <option value="‡∏ò‡∏∏‡∏£‡∏∞‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß">üë®‚Äçüë©‚Äçüëß ‡∏ò‡∏∏‡∏£‡∏∞‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</option>
                  <option value="‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå">‚öïÔ∏è ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå</option>
                  <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üìù ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                </select>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</label>
                <input type="text" id="formParent" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏á‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏ô‡∏ß‡∏•‡∏®‡∏£‡∏µ" class="w-full px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all" />
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
                <input type="tel" id="formPhone" placeholder="0XX-XXX-XXXX" class="w-full px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all" />
              </div>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">üì∏ ‡∏£‡∏π‡∏õ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏°‡∏≤‡∏£‡∏±‡∏ö (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
              <div class="relative border-2 border-dashed border-purple-300 rounded-xl p-4 text-center cursor-pointer hover:bg-purple-50 transition-all" onclick="document.getElementById('photoInput').click()">
                <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoChange(event)" />
                <p id="photoText" class="text-gray-600 font-medium">üì∑ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</p>
                <img id="photoPreview" style="display: none; max-height: 150px; margin-top: 10px; border-radius: 8px;" />
              </div>
            </div>

            <button class="btn-primary w-full text-lg animate-pulse-btn" id="submitBtn" onclick="submitRequest()">‚ú® ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>

            <div id="messageBox" style="padding: 16px; border-radius: 10px; display: none; font-weight: 600; border-left: 4px solid; text-align: center;"></div>
          </div>
        </div>

        <!-- HISTORY -->
        <div id="historyForm" class="hidden-page">
          <div class="glass rounded-2xl p-6 shadow-lg animate-slide-up">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏•‡∏≤</h2>
            <div id="historyList" class="space-y-4">
              <p class="text-center text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- üë®‚Äçüè´ TEACHER DASHBOARD -->
    <div id="teacherDashboard" class="w-full min-h-full p-4 hidden-page">
      <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="glass rounded-2xl p-6 mb-6 shadow-lg animate-slide-up">
          <div class="flex items-center justify-between gap-4 flex-wrap">
            <div class="flex items-center gap-4">
              <div style="font-size: 60px;">üë®‚Äçüè´</div>
              <div>
                <p class="text-2xl font-bold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤</p>
                <p class="text-gray-600 text-sm">‡∏Ñ‡∏£‡∏π / ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</p>
              </div>
            </div>
            <button class="btn-danger" onclick="logoutUser()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
          </div>
        </div>

        <!-- STATS -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div class="glass rounded-2xl p-4 shadow-lg border-l-4 border-yellow-400">
            <p class="text-3xl font-bold text-yellow-600" id="statPending">0</p>
            <p class="text-gray-700 font-semibold text-sm">‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
          </div>
          <div class="glass rounded-2xl p-4 shadow-lg border-l-4 border-green-400">
            <p class="text-3xl font-bold text-green-600" id="statApproved">0</p>
            <p class="text-gray-700 font-semibold text-sm">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</p>
          </div>
          <div class="glass rounded-2xl p-4 shadow-lg border-l-4 border-red-400">
            <p class="text-3xl font-bold text-red-600" id="statRejected">0</p>
            <p class="text-gray-700 font-semibold text-sm">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
          </div>
          <div class="glass rounded-2xl p-4 shadow-lg border-l-4 border-blue-400">
            <p class="text-3xl font-bold text-blue-600" id="statTotal">0</p>
            <p class="text-gray-700 font-semibold text-sm">üìä ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
          </div>
        </div>

        <!-- PENDING REQUESTS -->
        <div class="glass rounded-2xl p-6 shadow-lg">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">‚è≥ ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h2>
          <div id="pendingList" class="space-y-4">
            <p class="text-center text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
          </div>
        </div>

        <!-- ALL REQUESTS HISTORY -->
        <div class="glass rounded-2xl p-6 shadow-lg mt-6">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">üìä ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
          <div id="allRequestsList" class="space-y-4">
            <p class="text-center text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- MODAL DETAIL -->
  <div id="modalBackdrop" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; overflow-auto;" onclick="closeModal()">
    <div class="w-full min-h-full flex items-center justify-center p-4" onclick="event.stopPropagation()">
      <div class="glass rounded-2xl p-6 shadow-2xl w-full max-w-2xl animate-slide-up max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-2xl font-bold" id="modalTitle">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h3>
          <button onclick="closeModal()" class="text-2xl text-gray-400 hover:text-gray-600">‚úï</button>
        </div>
        
        <div id="modalContent"></div>

        <div id="modalActions" class="flex gap-3 mt-6 justify-end"></div>
      </div>
    </div>
  </div>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCm9QsD6NwRF0zusMzgESEyA43hjEyHRhw",
      authDomain: "sw-website-68.firebaseapp.com",
      projectId: "sw-website-68",
      storageBucket: "sw-website-68.firebasestorage.app",
      messagingSenderId: "123456789012",
      appId: "1:123456789012:web:28d2f983c552a118e9397c",
      databaseURL: "https://sw-website-68-default-rtdb.firebaseio.com"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const storage = firebase.storage();

    let currentUser = null;
    let allData = [];
    let currentPhotoFile = null;

    // ============ LOGIN FUNCTIONS ============
    function studentLogin() {
      const stdId = document.getElementById('studentId').value.trim();
      const natId = document.getElementById('nationalId').value.trim();
      const errorEl = document.getElementById('loginError');
      const errorText = document.getElementById('loginErrorText');

      if (!stdId || !natId || natId.length !== 4) {
        errorText.textContent = '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô';
        errorEl.style.display = 'block';
        return;
      }

      currentUser = { type: 'student', studentId: stdId, nationalId: natId };
      errorEl.style.display = 'none';
      
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('studentDashboard').style.display = 'block';
      document.getElementById('stdIdDisplay').textContent = stdId;

      const today = new Date().toISOString().split('T')[0];
      document.getElementById('formDate').value = today;
      
      loadData();
      loadStudentHistory();
      showNotification('‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
    }

    function showTeacherLoginPage() {
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('teacherLoginPage').style.display = 'flex';
    }

    function backToStudentLogin() {
      document.getElementById('teacherLoginPage').style.display = 'none';
      document.getElementById('loginPage').style.display = 'flex';
      document.getElementById('teacherLoginError').style.display = 'none';
    }

    function teacherLogin() {
      const username = document.getElementById('teacherUsername').value.trim();
      const password = document.getElementById('teacherPassword').value.trim();
      const errorEl = document.getElementById('teacherLoginError');
      const errorText = document.getElementById('teacherLoginErrorText');

      if (username === 'admin' && password === '1234') {
        currentUser = { type: 'teacher', username };
        errorEl.style.display = 'none';
        
        document.getElementById('teacherLoginPage').style.display = 'none';
        document.getElementById('teacherDashboard').style.display = 'block';
        
        loadData();
        showNotification('‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
      } else {
        errorText.textContent = '‚ùå ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
        errorEl.style.display = 'block';
      }
    }

    function logoutUser() {
      currentUser = null;
      allData = [];
      currentPhotoFile = null;

      document.getElementById('loginPage').style.display = 'flex';
      document.getElementById('studentDashboard').style.display = 'none';
      document.getElementById('teacherDashboard').style.display = 'none';
      
      document.getElementById('studentId').value = '';
      document.getElementById('nationalId').value = '';
      document.getElementById('teacherUsername').value = '';
      document.getElementById('teacherPassword').value = '';

      showNotification('üëã ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
    }

    // ============ LOAD DATA ============
    function loadData() {
      db.ref('requests').on('value', (snapshot) => {
        const data = snapshot.val();
        allData = data ? Object.entries(data).map(([key, val]) => ({ ...val, id: key })) : [];
        
        if (currentUser?.type === 'teacher') {
          updateTeacherView();
        }
      });
    }

    function loadStudentHistory() {
      if (!currentUser || currentUser.type !== 'student') return;

      db.ref('requests').on('value', (snapshot) => {
        const data = snapshot.val();
        const history = data ? Object.entries(data)
          .filter(([_, val]) => val.student_id === currentUser.studentId)
          .map(([key, val]) => ({ ...val, id: key }))
          .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
        : [];

        const historyList = document.getElementById('historyList');
        if (history.length === 0) {
          historyList.innerHTML = '<p class="text-center text-gray-500 py-8">üì≠ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏•‡∏≤</p>';
          return;
        }

        historyList.innerHTML = history.map(r => {
          const statusBadge = {
            'pending': '<span class="badge badge-pending">‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>',
            'approved': '<span class="badge badge-approved">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>',
            'rejected': '<span class="badge badge-rejected">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>'
          }[r.status] || '<span class="badge">‚ùì ‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö</span>';

          return `
            <div class="card cursor-pointer hover:shadow-lg transition-all" onclick="viewRequestDetail('${r.id}', 'student')">
              <div class="flex items-center justify-between">
                <div>
                  <p class="font-bold text-gray-800 mb-1">üìÖ ${r.date} üïê ${r.time}</p>
                  <p class="text-gray-600 text-sm">üìã ${r.reason}</p>
                  ${r.rejection_reason ? `<p class="text-red-600 text-sm mt-2">üí¨ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${r.rejection_reason}</p>` : ''}
                </div>
                <div class="text-right">
                  ${statusBadge}
                </div>
              </div>
            </div>
          `;
        }).join('');
      });
    }

    // ============ PHOTO HANDLING ============
    function handlePhotoChange(event) {
      const file = event.target.files[0];
      if (!file) return;

      currentPhotoFile = file;

      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          
          const maxSize = 1000;
          let width = img.width;
          let height = img.height;
          
          if (width > height) {
            if (width > maxSize) {
              height = Math.round(height * maxSize / width);
              width = maxSize;
            }
          } else {
            if (height > maxSize) {
              width = Math.round(width * maxSize / height);
              height = maxSize;
            }
          }
          
          canvas.width = width;
          canvas.height = height;
          ctx.drawImage(img, 0, 0, width, height);
          
          canvas.toBlob((blob) => {
            currentPhotoFile = new File([blob], file.name, { type: 'image/jpeg' });
            
            const preview = document.getElementById('photoPreview');
            preview.src = canvas.toDataURL();
            preview.style.display = 'block';
            
            document.getElementById('photoText').textContent = `‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: ${file.name}`;
          }, 'image/jpeg', 0.8);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    // ============ SUBMIT REQUEST ============
    async function submitRequest() {
      const name = document.getElementById('formName').value.trim();
      const classRoom = document.getElementById('formClass').value.trim();
      const date = document.getElementById('formDate').value;
      const time = document.getElementById('formTime').value;
      const timeIn = document.getElementById('formTimeIn').value;
      const reason = document.getElementById('formReason').value;
      const parent = document.getElementById('formParent').value.trim();
      const phone = document.getElementById('formPhone').value.trim();
      const msgBox = document.getElementById('messageBox');
      const submitBtn = document.getElementById('submitBtn');

      if (!name || !classRoom || !date || !time || !reason || !parent || !phone) {
        msgBox.textContent = '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô';
        msgBox.style.background = '#fee2e2';
        msgBox.style.color = '#dc2626';
        msgBox.style.borderColor = '#dc2626';
        msgBox.style.display = 'block';
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';

      try {
        let photoUrl = '';
        
        if (currentPhotoFile) {
          const timestamp = Date.now();
          const fileName = `${currentUser.studentId}_${timestamp}.jpg`;
          const storageRef = storage.ref(`photos/${fileName}`);
          await storageRef.put(currentPhotoFile);
          photoUrl = await storageRef.getDownloadURL();
        }

        const request = {
          student_id: currentUser.studentId,
          national_id: currentUser.nationalId,
          name,
          class_room: classRoom,
          date,
          time_out: time,
          time_in: timeIn || '',
          reason,
          parent_name: parent,
          parent_phone: phone,
          photo_url: photoUrl,
          status: 'pending',
          rejection_reason: '',
          created_at: new Date().toISOString()
        };

        await db.ref('requests').push(request);

        msgBox.textContent = '‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏Ñ‡∏£‡∏π‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÑ‡∏°‡πà‡∏ä‡πâ‡∏≤';
        msgBox.style.background = '#d1fae5';
        msgBox.style.color = '#059669';
        msgBox.style.borderColor = '#059669';
        msgBox.style.display = 'block';

        document.getElementById('formName').value = '';
        document.getElementById('formClass').value = '';
        document.getElementById('formTime').value = '';
        document.getElementById('formTimeIn').value = '';
        document.getElementById('formReason').value = '';
        document.getElementById('formParent').value = '';
        document.getElementById('formPhone').value = '';
        document.getElementById('photoPreview').style.display = 'none';
        document.getElementById('photoText').textContent = 'üì∑ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ';
        currentPhotoFile = null;

        showNotification('üéâ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!', 'success');

        setTimeout(() => { 
          msgBox.style.display = 'none'; 
          loadStudentHistory();
        }, 3000);
      } catch (err) {
        console.error('Error:', err);
        msgBox.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message;
        msgBox.style.background = '#fee2e2';
        msgBox.style.color = '#dc2626';
        msgBox.style.borderColor = '#dc2626';
        msgBox.style.display = 'block';
        showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = '‚ú® ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠';
      }
    }

    // ============ TEACHER FUNCTIONS ============
    function updateTeacherView() {
      const pending = allData<!DOCTYPE html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤ÔøΩÔøΩÔøΩ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Prompt', sans-serif;
      box-sizing: border-box;
    }
    * {
      box-sizing: border-box;
    }
    body {
      box-sizing: border-box;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    .float-anim { animation: float 3s ease-in-out infinite; }
    input, textarea, select {
      font-family: 'Prompt', sans-serif !important;
    }
    button {
      font-family: 'Prompt', sans-serif !important;
    }
    .glass {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
    }
    .hidden-page {
      display: none !important;
    }
  </style>
</head>
<body class="h-full w-full bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 overflow-auto">
  <div id="app" class="min-h-full w-full">

    <!-- LOGIN PAGE -->
    <div id="loginPage" class="w-full min-h-full flex items-center justify-center p-4">
      <div class="w-full max-w-md">
        <div class="glass rounded-2xl p-8 shadow-2xl">
          <div class="text-center mb-8">
            <div class="text-7xl mb-4 float-anim">üë®‚Äçüéì</div>
            <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô</h1>
            <p class="text-gray-600 text-lg">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
          </div>

          <div class="space-y-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">üé´ ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
              <input type="text" id="studentId" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß" class="w-full px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 focus:ring-2 focus:ring-purple-200 transition-all" />
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">ü™™ ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢)</label>
              <input type="text" id="nationalId" placeholder="‡∏Å‡∏£‡∏≠‡∏Å 4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢" maxlength="4" class="w-full px-4 py-3 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 focus:ring-2 focus:ring-purple-200 transition-all" />
            </div>

            <button type="button" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 14px; border-radius: 12px; font-weight: 700; font-size: 16px; cursor: pointer; width: 100%; transition: all 0.3s ease;" onmousedown="this.style.transform='scale(0.98)'" onmouseup="this.style.transform='scale(1)'" onclick="studentLogin()">
              üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
            </button>

            <div class="relative my-6">
              <div class="absolute inset-0 flex items-center"><div class="w-full border-t-2 border-gray-300"></div></div>
              <div class="relative flex justify-center"><span class="px-3 bg-white text-gray-500 font-medium">‡∏´‡∏£‡∏∑‡∏≠</span></div>
            </div>

            <button type="button" style="background: white; color: #10b981; border: 2px solid #10b981; padding: 14px; border-radius: 12px; font-weight: 700; font-size: 16px; cursor: pointer; width: 100%; transition: all 0.3s ease;" onmousedown="this.style.transform='scale(0.98)'" onmouseup="this.style.transform='scale(1)'" onclick="showTeacherLoginPage()">
              üë®‚Äçüè´ ‡∏Ñ‡∏£‡∏π/‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
            </button>
          </div>

          <div id="loginError" class="mt-4 p-3 bg-red-50 border-l-4 border-red-500 text-red-700 rounded-lg hidden">
            <p class="font-semibold" id="loginErrorText">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
          </div>
        </div>
      </div>
    </div>

    <!-- TEACHER LOGIN PAGE -->
    <div id="teacherLoginPage" class="w-full min-h-full flex items-center justify-center p-4 hidden-page">
      <div class="w-full max-w-md">
        <div class="glass rounded-2xl p-8 shadow-2xl">
          <div class="text-center mb-8">
            <div class="text-7xl mb-4 float-anim">üë®‚Äçüè´</div>
            <h1 class="text-3xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</h1>
            <p class="text-gray-600 text-lg">‡∏™‡∏≥‡∏´‡∏£ÔøΩÔøΩ‡∏ö‡∏Ñ‡∏£‡∏π‡πÅ‡∏•‡∏∞ÔøΩÔøΩÔøΩ‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
          </div>

          <div class="space-y-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
              <input type="text" id="teacherUsername" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" class="w-full px-4 py-3 border-2 border-green-300 rounded-xl focus:outline-none focus:border-green-600 focus:ring-2 focus:ring-green-200 transition-all" />
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">üîë ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
              <input type="password" id="teacherPassword" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full px-4 py-3 border-2 border-green-300 rounded-xl focus:outline-none focus:border-green-600 focus:ring-2 focus:ring-green-200 transition-all" />
            </div>

            <button type="button" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 14px; border-radius: 12px; font-weight: 700; font-size: 16px; cursor: pointer; width: 100%; transition: all 0.3s ease;" onmousedown="this.style.transform='scale(0.98)'" onmouseup="this.style.transform='scale(1)'" onclick="teacherLogin()">
              üîì ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
            </button>

            <button type="button" style="background: white; color: #6b7280; border: 2px solid #d1d5db; padding: 14px; border-radius: 12px; font-weight: 700; font-size: 16px; cursor: pointer; width: 100%; transition: all 0.3s ease;" onmousedown="this.style.transform='scale(0.98)'" onmouseup="this.style.transform='scale(1)'" onclick="backToStudentLogin()">
              ‚Üê ‡∏Å‡∏•‡∏±‡∏ö
            </button>

            <div class="p-3 bg-blue-50 border-l-4 border-blue-500 text-blue-700 rounded-lg text-sm">
              <p class="font-semibold">üí° ‡∏ó‡∏î‡∏™‡∏≠‡∏ö: admin / 1234</p>
            </div>
          </div>

          <div id="teacherLoginError" class="mt-4 p-3 bg-red-50 border-l-4 border-red-500 text-red-700 rounded-lg hidden">
            <p class="font-semibold" id="teacherLoginErrorText">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
          </div>
        </div>
      </div>
    </div>

    <!-- STUDENT DASHBOARD -->
    <div id="studentDashboard" class="w-full min-h-full p-4 hidden-page">
      <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="glass rounded-2xl p-6 mb-6 shadow-lg">
          <div class="flex items-center justify-between gap-4">
            <div class="flex items-center gap-4">
              <div class="text-6xl">üë®‚Äçüéì</div>
              <div>
                <p class="text-2xl font-bold text-gray-800">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</p>
                <p class="text-gray-600">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß: <span id="stdIdDisplay">-</span></p>
              </div>
            </div>
            <button type="button" style="background: #ef4444; color: white; border: none; padding: 12px 20px; border-radius: 10px; font-weight: 700; cursor: pointer; transition: all 0.3s ease;" onmousedown="this.style.transform='scale(0.98)'" onmouseup="this.style.transform='scale(1)'" onclick="logoutUser()">
              üö™ ‡∏≠‡∏≠‡∏Å
            </button>
          </div>
        </div>

        <!-- Content -->
        <div id="studentContent" class="glass rounded-2xl p-6 shadow-lg">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">üìù ‡∏Ç‡∏≠‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏öÔøΩÔøΩ‡πâ‡∏≤‡∏ô</h2>

          <div class="space-y-5">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üë§ ‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
                <input type="text" id="formName" placeholder="‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="w-full px-4 py-2 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all" />
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üè´ ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                <input type="text" id="formClass" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°.3/1" class="w-full px-4 py-2 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all" />
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤</label>
                <input type="date" id="formDate" class="w-full px-4 py-2 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all" />
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üïê ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</label>
                <input type="time" id="formTime" class="w-full px-4 py-2 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all" />
              </div>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">üìã ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label>
              <select id="formReason" class="w-full px-4 py-2 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all">
                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• --</option>
                <option value="‡∏õ‡πà‡∏ß‡∏¢">üè• ‡∏õ‡πà‡∏ß‡∏¢</option>
                <option value="‡∏ò‡∏∏‡∏£‡∏∞‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß">üë®‚Äçüë©‚Äçüëß ‡∏ò‡∏∏‡∏£‡∏∞‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</option>
                <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üìù ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
              </select>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</label>
                <input type="text" id="formParent" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á" class="w-full px-4 py-2 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all" />
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
                <input type="tel" id="formPhone" placeholder="0XX-XXX-XXXX" class="w-full px-4 py-2 border-2 border-purple-300 rounded-xl focus:outline-none focus:border-purple-600 transition-all" />
              </div>
            </div>

            <button type="button" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 16px; border-radius: 12px; font-weight: 700; font-size: 16px; cursor: pointer; width: 100%; transition: all 0.3s ease;" onmousedown="this.style.transform='scale(0.98)'" onmouseup="this.style.transform='scale(1)'" onclick="submitRequest()">
              ‚ú® ‡∏™‡πà‡∏á‡∏Ñ‡∏≥ÔøΩÔøΩÔøΩ‡∏≠
            </button>

            <div id="messageBox" style="padding: 12px; border-radius: 10px; display: none; font-weight: 600;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- TEACHER DASHBOARD -->
    <div id="teacherDashboard" class="w-full min-h-full p-4 hidden-page">
      <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="glass rounded-2xl p-6 mb-6 shadow-lg">
          <div class="flex items-center justify-between gap-4">
            <div class="flex items-center gap-4">
              <div class="text-6xl">üë®‚Äçüè´</div>
              <div>
                <p class="text-2xl font-bold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</p>
                <p class="text-gray-600">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
              </div>
            </div>
            <button type="button" style="background: #ef4444; color: white; border: none; padding: 12px 20px; border-radius: 10px; font-weight: 700; cursor: pointer; transition: all 0.3s ease;" onmousedown="this.style.transform='scale(0.98)'" onmouseup="this.style.transform='scale(1)'" onclick="logoutUser()">
              üö™ ‡∏≠‡∏≠‡∏Å
            </button>
          </div>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div class="glass rounded-2xl p-4 shadow-lg">
            <p class="text-3xl font-bold text-yellow-600" id="statPending">0</p>
            <p class="text-gray-700 font-semibold">‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
          </div>
          <div class="glass rounded-2xl p-4 shadow-lg">
            <p class="text-3xl font-bold text-green-600" id="statApproved">0</p>
            <p class="text-gray-700 font-semibold">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</p>
          </div>
          <div class="glass rounded-2xl p-4 shadow-lg">
            <p class="text-3xl font-bold text-red-600" id="statRejected">0</p>
            <p class="text-gray-700 font-semibold">‚ùå ÔøΩÔøΩ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
          </div>
          <div class="glass rounded-2xl p-4 shadow-lg">
            <p class="text-3xl font-bold text-blue-600" id="statTotal">0</p>
            <p class="text-gray-700 font-semibold">üìä ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
          </div>
        </div>

        <!-- Pending Requests -->
        <div id="pendingSection" class="glass rounded-2xl p-6 shadow-lg">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">‚è≥ ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h2>
          <div id="pendingList" class="space-y-3"></div>
        </div>
      </div>
    </div>

  </div>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCm9QsD6NwRF0zusMzgESEyA43hjEyHRhw",
      authDomain: "sw-website-68.firebaseapp.com",
      databaseURL: "https://sw-website-68-default-rtdb.firebaseio.com",
      projectId: "sw-website-68",
      storageBucket: "sw-website-68.firebasestorage.app",
      messagingSenderId: "123456789012",
      appId: "1:123456789012:web:28d2f983c552a118e9397c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUser = null;
    let allData = [];

    // LOGIN FUNCTIONS
    function studentLogin() {
      const stdId = document.getElementById('studentId').value.trim();
      const natId = document.getElementById('nationalId').value.trim();
      const errorEl = document.getElementById('loginError');
      const errorText = document.getElementById('loginErrorText');

      if (!stdId || !natId || natId.length !== 4) {
        errorText.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô';
        errorEl.style.display = 'block';
        return;
      }

      currentUser = { type: 'student', studentId: stdId, nationalId: natId };
      errorEl.style.display = 'none';
      
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('studentDashboard').style.display = 'block';
      document.getElementById('stdIdDisplay').textContent = stdId;

      const today = new Date().toISOString().split('T')[0];
      document.getElementById('formDate').value = today;
      
      loadData();
    }

    function showTeacherLoginPage() {
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('teacherLoginPage').style.display = 'flex';
    }

    function backToStudentLogin() {
      document.getElementById('teacherLoginPage').style.display = 'none';
      document.getElementById('loginPage').style.display = 'flex';
    }

    function teacherLogin() {
      const username = document.getElementById('teacherUsername').value.trim();
      const password = document.getElementById('teacherPassword').value.trim();
      const errorEl = document.getElementById('teacherLoginError');
      const errorText = document.getElementById('teacherLoginErrorText');

      if (username === 'admin' && password === '1234') {
        currentUser = { type: 'teacher', username };
        errorEl.style.display = 'none';
        
        document.getElementById('teacherLoginPage').style.display = 'none';
        document.getElementById('teacherDashboard').style.display = 'block';
        
        loadData();
      } else {
        errorText.textContent = '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
        errorEl.style.display = 'block';
      }
    }

    function logoutUser() {
      currentUser = null;
      document.getElementById('loginPage').style.display = 'flex';
      document.getElementById('studentDashboard').style.display = 'none';
      document.getElementById('teacherDashboard').style.display = 'none';
      document.getElementById('studentId').value = '';
      document.getElementById('nationalId').value = '';
      document.getElementById('teacherUsername').value = '';
      document.getElementById('teacherPassword').value = '';
    }

    // LOAD DATA
    function loadData() {
      db.ref('requests').on('value', (snapshot) => {
        const data = snapshot.val();
        allData = data ? Object.entries(data).map(([key, val]) => ({ ...val, id: key })) : [];
        
        if (currentUser?.type === 'teacher') {
          updateTeacherView();
        }
      });
    }

    // SUBMIT REQUEST
    function submitRequest() {
      const name = document.getElementById('formName').value.trim();
      const classRoom = document.getElementById('formClass').value.trim();
      const date = document.getElementById('formDate').value;
      const time = document.getElementById('formTime').value;
      const reason = document.getElementById('formReason').value;
      const parent = document.getElementById('formParent').value.trim();
      const phone = document.getElementById('formPhone').value.trim();
      const msgBox = document.getElementById('messageBox');

      if (!name || !classRoom || !date || !time || !reason || !parent || !phone) {
        msgBox.textContent = '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô';
        msgBox.style.background = '#fee2e2';
        msgBox.style.color = '#dc2626';
        msgBox.style.display = 'block';
        return;
      }

      const request = {
        student_id: currentUser.studentId,
        national_id: currentUser.nationalId,
        name,
        class_room: classRoom,
        date,
        time,
        reason,
        parent_name: parent,
        parent_phone: phone,
        status: 'pending',
        created_at: new Date().toISOString()
      };

      db.ref('requests').push(request).then(() => {
        msgBox.textContent = '‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!';
        msgBox.style.background = '#d1fae5';
        msgBox.style.color = '#059669';
        msgBox.style.display = 'block';

        document.getElementById('formName').value = '';
        document.getElementById('formClass').value = '';
        document.getElementById('formReason').value = '';
        document.getElementById('formParent').value = '';
        document.getElementById('formPhone').value = '';

        setTimeout(() => { msgBox.style.display = 'none'; }, 3000);
      }).catch(err => {
        msgBox.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏îÔøΩÔøΩ‡∏•‡∏≤‡∏î';
        msgBox.style.background = '#fee2e2';
        msgBox.style.color = '#dc2626';
        msgBox.style.display = 'block';
      });
    }

    // UPDATE TEACHER VIEW
    function updateTeacherView() {
      const pending = allData.filter(r => r.status === 'pending');
      const approved = allData.filter(r => r.status === 'approved').length;
      const rejected = allData.filter(r => r.status === 'rejected').length;

      document.getElementById('statPending').textContent = pending.length;
      document.getElementById('statApproved').textContent = approved;
      document.getElementById('statRejected').textContent = rejected;
      document.getElementById('statTotal').textContent = allData.length;

      const listEl = document.getElementById('pendingList');
      if (pending.length === 0) {
        listEl.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡∏£‡∏≠</p>';
        return;
      }

      listEl.innerHTML = pending.map(r => `
        <div style="padding: 16px; background: white; border-left: 4px solid #fbbf24; border-radius: 10px;">
          <p style="font-weight: 700; color: #1f2937; margin: 0 0 8px 0; font-size: 16px;">${r.name} (${r.class_room})</p>
          <p style="font-size: 14px; color: #666; margin: 4px 0;">üìÖ ${r.date} üïê ${r.time}</p>
          <p style="font-size: 14px; color: #666; margin: 4px 0;">üë§ ${r.parent_name} | üì± ${r.parent_phone}</p>
          <p style="font-size: 14px; color: #666; margin: 4px 0;">üìã ${r.reason}</p>
          <div style="display: flex; gap: 10px; margin-top: 12px;">
            <button type="button" style="background: #10b981; color: white; border: none; padding: 10px 16px; border-radius: 8px; font-weight: 700; cursor: pointer; flex: 1; transition: all 0.3s;" onmousedown="this.style.transform='scale(0.98)'" onmouseup="this.style.transform='scale(1)'" onclick="approveRequest('${r.id}')">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
            <button type="button" style="background: #ef4444; color: white; border: none; padding: 10px 16px; border-radius: 8px; font-weight: 700; cursor: pointer; flex: 1; transition: all 0.3s;" onmousedown="this.style.transform='scale(0.98)'" onmouseup="this.style.transform='scale(1)'" onclick="rejectRequest('${r.id}')">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
          </div>
        </div>
      `).join('');
    }

    function approveRequest(id) {
      db.ref(`requests/${id}`).update({ status: 'approved' }).then(() => {
        loadData();
      });
    }

    function rejectRequest(id) {
      db.ref(`requests/${id}`).update({ status: 'rejected' }).then(() => {
        loadData();
      });
    }
  </script>
</body>
</html>
.filter(r => r.status === 'pending');
      const approved = allData.filter(r => r.status === 'approved').length;
      const rejected = allData.filter(r => r.status === 'rejected').length;

      document.getElementById('statPending').textContent = pending.length;
      document.getElementById('statApproved').textContent = approved;
      document.getElementById('statRejected').textContent = rejected;
      document.getElementById('statTotal').textContent = allData.length;

      // Pending Requests
      const pendingList = document.getElementById('pendingList');
      if (pending.length === 0) {
        pendingList.innerHTML = '<p class="text-center text-gray-500 py-8">‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>';
      } else {
        pendingList.innerHTML = pending.map(r => `
          <div class="card cursor-pointer hover:shadow-lg transition-all" onclick="viewRequestDetail('${r.id}', 'teacher')">
            <div class="flex items-center justify-between flex-wrap gap-3">
              <div class="flex-1">
                <p class="font-bold text-gray-800 text-lg mb-2">${r.name} <span class="text-sm text-gray-600">(${r.class_room})</span></p>
                <p class="text-gray-600 text-sm mb-1">üé´ ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß: ${r.student_id}</p>
                <p class="text-gray-600 text-sm mb-1">üìÖ ${r.date} | üïê ${r.time_out}</p>
                <p class="text-gray-600 text-sm">üë§ ${r.parent_name} | üì± ${r.parent_phone}</p>
              </div>
              <div class="text-right">
                <span class="badge badge-pending">‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
              </div>
            </div>
          </div>
        `).join('');
      }

      // All Requests
      const allList = document.getElementById('allRequestsList');
      if (allData.length === 0) {
        allList.innerHTML = '<p class="text-center text-gray-500 py-8">üì≠ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
        return;
      }

      const sortedData = [...allData].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
      allList.innerHTML = sortedData.map(r => {
        const statusBadge = {
          'pending': '<span class="badge badge-pending">‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>',
          'approved': '<span class="badge badge-approved">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>',
          'rejected': '<span class="badge badge-rejected">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>'
        }[r.status] || '<span class="badge">‚ùì ‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö</span>';

        return `
          <div class="card cursor-pointer hover:shadow-lg transition-all" onclick="viewRequestDetail('${r.id}', 'teacher')">
            <div class="flex items-center justify-between flex-wrap gap-3">
              <div class="flex-1">
                <p class="font-bold text-gray-800 mb-1">${r.name} (${r.class_room})</p>
                <p class="text-gray-600 text-sm">üìÖ ${r.date} üïê ${r.time_out} | üìã ${r.reason}</p>
              </div>
              <div class="text-right">
                ${statusBadge}
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    async function viewRequestDetail(id, userType) {
      const request = allData.find(r => r.id === id);
      if (!request) return;

      const modal = document.getElementById('modalBackdrop');
      const modalTitle = document.getElementById('modalTitle');
      const modalContent = document.getElementById('modalContent');
      const modalActions = document.getElementById('modalActions');

      modalTitle.textContent = `${request.name} (${request.class_room})`;

      let html = `
        <div class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div class="p-3 bg-gray-50 rounded-lg">
              <p class="text-gray-600 text-sm">üé´ ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</p>
              <p class="font-bold text-gray-800">${request.student_id}</p>
            </div>
            <div class="p-3 bg-gray-50 rounded-lg">
              <p class="text-gray-600 text-sm">ü™™ ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</p>
              <p class="font-bold text-gray-800">****${request.national_id}</p>
            </div>
            <div class="p-3 bg-gray-50 rounded-lg">
              <p class="text-gray-600 text-sm">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤</p>
              <p class="font-bold text-gray-800">${request.date}</p>
            </div>
            <div class="p-3 bg-gray-50 rounded-lg">
              <p class="text-gray-600 text-sm">üïê ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</p>
              <p class="font-bold text-gray-800">${request.time_out}</p>
            </div>
            ${request.time_in ? `
              <div class="p-3 bg-gray-50 rounded-lg">
                <p class="text-gray-600 text-sm">üïë ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö</p>
                <p class="font-bold text-gray-800">${request.time_in}</p>
              </div>
            ` : ''}
            <div class="p-3 bg-gray-50 rounded-lg">
              <p class="text-gray-600 text-sm">üìã ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</p>
              <p class="font-bold text-gray-800">${request.reason}</p>
            </div>
          </div>

          <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400">
            <p class="text-gray-600 text-sm mb-1">üë§ ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</p>
            <p class="font-bold text-gray-800">${request.parent_name}</p>
            <p class="text-gray-600 text-sm">üì± ${request.parent_phone}</p>
          </div>

          ${request.photo_url ? `
            <div class="p-4 bg-gray-50 rounded-lg">
              <p class="text-gray-600 text-sm mb-3">üì∏ ‡∏£‡∏π‡∏õ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏°‡∏≤‡∏£‡∏±‡∏ö</p>
              <img src="${request.photo_url}" style="max-width: 100%; border-radius: 8px; max-height: 300px;" alt="Photo" loading="lazy" onerror="console.error('Image failed to load:', this.src); this.style.background='#e5e7eb'; this.alt='Image unavailable';" />
            </div>
          ` : ''}

          <div class="p-4 bg-gray-50 rounded-lg">
            <p class="text-gray-600 text-sm">‚è∞ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠</p>
            <p class="font-bold text-gray-800">${new Date(request.created_at).toLocaleString('th-TH')}</p>
          </div>
        </div>
      `;

      modalContent.innerHTML = html;

      if (userType === 'teacher' && request.status === 'pending') {
        modalActions.innerHTML = `
          <textarea id="rejectionNote" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (‡∏ñ‡πâ‡∏≤‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò)" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Prompt', sans-serif; margin-bottom: 10px; display: none;" rows="3"></textarea>
          <button class="btn-success" onclick="approveRequest('${id}')">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
          <button class="btn-danger" onclick="toggleRejectionNote()">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
        `;
      } else if (userType === 'teacher' && request.status === 'rejected' && request.rejection_reason) {
        modalActions.innerHTML = `
          <div class="p-3 bg-red-50 border-l-4 border-red-400 rounded-lg w-full mb-3">
            <p class="text-red-600 text-sm font-semibold">üí¨ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</p>
            <p class="text-red-600">${request.rejection_reason}</p>
          </div>
          <button class="btn-success" onclick="approveRequest('${id}')">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
          <button class="btn-danger" onclick="toggleRejectionNote('${request.rejection_reason}')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</button>
        `;
      }

      modal.style.display = 'flex';
    }

    let rejectionRequestId = '';
    function toggleRejectionNote(existingNote = '') {
      const textarea = document.getElementById('rejectionNote');
      if (textarea.style.display === 'none') {
        textarea.style.display = 'block';
        if (existingNote) textarea.value = existingNote;
        textarea.focus();
      } else {
        if (!textarea.value.trim()) {
          showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏', 'error');
          return;
        }
        rejectionRequestId = textarea.getAttribute('data-request-id');
        rejectRequest(rejectionRequestId, textarea.value);
      }
    }

    function approveRequest(id) {
      db.ref(`requests/${id}`).update({ status: 'approved', rejection_reason: '' }).then(() => {
        closeModal();
        showNotification('‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!', 'success');
        loadData();
      }).catch(err => {
        showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message, 'error');
      });
    }

    function rejectRequest(id, note) {
      const textarea = document.getElementById('rejectionNote');
      const rejectionNote = textarea ? textarea.value.trim() : note;

      if (!rejectionNote) {
        showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'error');
        return;
      }

      db.ref(`requests/${id}`).update({ 
        status: 'rejected', 
        rejection_reason: rejectionNote 
      }).then(() => {
        closeModal();
        showNotification('‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!', 'success');
        loadData();
      }).catch(err => {
        showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message, 'error');
      });
    }

    function closeModal() {
      document.getElementById('modalBackdrop').style.display = 'none';
      document.getElementById('rejectionNote').style.display = 'none';
      document.getElementById('rejectionNote').value = '';
    }

    // ============ UI FUNCTIONS ============
    function switchTab(tab) {
      const tabRequest = document.getElementById('tabRequest');
      const tabHistory = document.getElementById('tabHistory');
      const requestForm = document.getElementById('requestForm');
      const historyForm = document.getElementById('historyForm');

      if (tab === 'request') {
        requestForm.classList.remove('hidden-page');
        historyForm.classList.add('hidden-page');
        tabRequest.style.cssText = 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;';
        tabHistory.style.cssText = 'background: #e5e7eb; color: #374151;';
      } else {
        requestForm.classList.add('hidden-page');
        historyForm.classList.remove('hidden-page');
        tabRequest.style.cssText = 'background: #e5e7eb; color: #374151;';
        tabHistory.style.cssText = 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;';
        loadStudentHistory();
      }
    }

    function showNotification(message, type) {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);

      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transition = 'opacity 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Modal Backdrop Click
    document.getElementById('modalBackdrop').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });

    // Rejection Note Textarea Button
    function toggleRejectionNote(existingNote = '') {
      const textarea = document.getElementById('rejectionNote');
      const actionBtns = document.getElementById('modalActions').querySelectorAll('button');
      
      if (textarea.style.displ
