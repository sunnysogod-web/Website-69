<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js"></script>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body, #app {
            height: 100%;
            width: 100%;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ===== LOGIN PAGE ===== */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .school-logo {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .login-header h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .login-header p {
            color: #999;
            font-size: 14px;
        }

        .role-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .role-btn {
            padding: 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            color: #999;
            transition: all 0.3s;
        }

        .role-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-group input {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* ===== MAIN APP ===== */
        .app-header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-info .emoji {
            font-size: 40px;
        }

        .header-info h2 {
            color: #333;
            font-size: 20px;
        }

        .header-info p {
            color: #999;
            font-size: 14px;
            margin: 0;
        }

        .logout-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #ff5252;
        }

        /* ===== STUDENT VIEW ===== */
        .student-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-section, .history-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .section-title {
            color: #667eea;
            font-size: 22px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-section .form-group {
            margin-bottom: 15px;
        }

        .form-section label {
            font-weight: 600;
            color: #333;
            display: block;
            margin-bottom: 8px;
        }

        .form-section input, .form-section select, .form-section textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-section textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-section input:focus, .form-section select:focus, .form-section textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* ===== HISTORY ===== */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 500px;
            overflow-y: auto;
        }

        .history-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .history-item-date {
            color: #333;
            font-weight: 600;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending {
            background: #fff3cd;
            color: #ff9800;
        }

        .status-approved {
            background: #d4edda;
            color: #28a745;
        }

        .status-rejected {
            background: #f8d7da;
            color: #dc3545;
        }

        .history-item-time {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }

        .history-item-reason {
            font-size: 13px;
            color: #555;
        }

        .reject-reason {
            background: #fff5f5;
            padding: 8px;
            border-radius: 6px;
            font-size: 12px;
            color: #dc3545;
            margin-top: 8px;
        }

        /* ===== TEACHER DASHBOARD ===== */
        .teacher-dashboard {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .stats-panel {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            display: block;
        }

        .stat-label {
            font-size: 13px;
            margin-top: 5px;
        }

        .requests-panel {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .filter-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 15px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .requests-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 500px;
            overflow-y: auto;
        }

        .request-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }

        .request-card.rejected {
            border-left-color: #dc3545;
            background: #fff5f5;
        }

        .request-card.approved {
            border-left-color: #28a745;
            background: #f1f9f1;
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .student-info {
            flex: 1;
        }

        .student-name {
            color: #333;
            font-weight: 700;
            font-size: 16px;
        }

        .student-id {
            color: #999;
            font-size: 12px;
            margin-top: 2px;
        }

        .request-details {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 13px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            color: #999;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .detail-value {
            color: #333;
            font-weight: 500;
        }

        .request-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        .action-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .approve-btn {
            background: #28a745;
            color: white;
        }

        .approve-btn:hover {
            background: #218838;
        }

        .reject-btn {
            background: #dc3545;
            color: white;
        }

        .reject-btn:hover {
            background: #c82333;
        }

        .rejection-form {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
        }

        .rejection-form textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
        }

        .rejection-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }

        .cancel-reject-btn {
            background: #e0e0e0;
            color: #333;
        }

        .confirm-reject-btn {
            background: #dc3545;
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-left: 4px solid #28a745;
            color: #28a745;
        }

        .notification.error {
            border-left: 4px solid #dc3545;
            color: #dc3545;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            .student-container {
                grid-template-columns: 1fr;
            }

            .teacher-dashboard {
                grid-template-columns: 1fr;
            }

            .request-details {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 600px) {
            .login-card {
                padding: 25px;
            }

            .app-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div id="app"></div>
  <script>
        // Global State
        let currentUser = null;
        let currentRole = null;
        let requests = [];
        let database = null;

        // ===== FIREBASE SETUP =====
        function initFirebase() {
            const firebaseConfig = {
                apiKey: "AIzaSyCm9QsD6NwRF0zusMzgESEyA43hjEyHRhw",
                authDomain: "sw-website-68.firebaseapp.com",
                databaseURL: "https://sw-website-68-default-rtdb.firebaseio.com",
                projectId: "sw-website-68",
                storageBucket: "sw-website-68.firebasestorage.app",
                messagingSenderId: "123456789012",
                appId: "1:123456789012:web:28d2f983c552a118e9397c",
                measurementId: "G-ESPPG76N3H"
            };

            try {
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                console.log('‚úÖ Firebase ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                return true;
            } catch (error) {
                console.error('‚ùå Firebase error:', error);
                showNotification('‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î Firebase - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤', 'error');
                return false;
            }
        }

        // ===== NOTIFICATION SYSTEM =====
        function showNotification(message, type = 'success') {
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.textContent = message;
            document.body.appendChild(notif);

            setTimeout(() => {
                notif.remove();
            }, 3000);
        }

        // ===== LOGIN =====
        function renderLoginPage() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="login-container">
                    <div class="login-card">
                        <div class="login-header">
                            <div class="school-logo">üè´</div>
                            <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô</h1>
                            <p>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏∏‡∏£‡∏û‡∏á‡∏Ñ‡πå‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</p>
                        </div>

                        <div class="role-selector">
                            <button class="role-btn active" onclick="selectRole('student')">
                                üë®‚Äçüéì ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                            </button>
                            <button class="role-btn" onclick="selectRole('teacher')">
                                üë®‚Äçüè´ ‡∏Ñ‡∏£‡∏π
                            </button>
                        </div>

                        <form class="login-form" id="loginForm">
                            <div class="form-group">
                                <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                                <input type="text" id="username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required>
                            </div>
                            <div class="form-group">
                                <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                                <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                            </div>
                            <button type="submit" class="login-btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                        </form>
                    </div>
                </div>
            `;

            currentRole = 'student';
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
        }

        function selectRole(role) {
            currentRole = role;
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username.length < 3 || password.length < 3) {
                showNotification('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏≤‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£', 'error');
                return;
            }

            currentUser = {
                username: username,
                role: currentRole,
                id: `${currentRole}-${username}`
            };

            if (currentRole === 'student') {
                renderStudentPage();
            } else {
                renderTeacherPage();
            }

            showNotification('‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        }

        // ===== STUDENT PAGE =====
        function renderStudentPage() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="container">
                    <div class="app-header">
                        <div class="header-info">
                            <div class="emoji">üë®‚Äçüéì</div>
                            <div>
                                <h2>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ${currentUser.username}</h2>
                                <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô</p>
                            </div>
                        </div>
                        <button class="logout-btn" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                    </div>

                    <div class="student-container">
                        <div class="form-section">
                            <div class="section-title">üìù ‡∏Ç‡∏≠‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô</div>
                            <form id="leaveForm">
                                <div class="form-group">
                                    <label>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                                    <input type="text" id="studentId" placeholder="‡πÄ‡∏ä‡πà‡∏ô 12345" required>
                                </div>

                                <div class="form-group">
                                    <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
                                    <input type="text" id="studentName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" required>
                                </div>

                                <div class="form-group">
                                    <label>‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                                    <select id="studentClass" required>
                                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>
                                        <option value="‡∏°.1">‡∏°.1</option>
                                        <option value="‡∏°.2">‡∏°.2</option>
                                        <option value="‡∏°.3">‡∏°.3</option>
                                        <option value="‡∏°.4">‡∏°.4</option>
                                        <option value="‡∏°.5">‡∏°.5</option>
                                        <option value="‡∏°.6">‡∏°.6</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤</label>
                                    <input type="date" id="leaveDate" required>
                                </div>

                                <div class="form-group">
                                    <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</label>
                                    <input type="time" id="leaveTime" required>
                                </div>

                                <div class="form-group">
                                    <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ (‡∏´‡∏≤‡∏Å‡∏°‡∏µ)</label>
                                    <input type="time" id="returnTime">
                                </div>

                                <div class="form-group">
                                    <label>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label>
                                    <textarea id="reason" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•" required></textarea>
                                </div>

                                <div class="form-group">
                                    <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</label>
                                    <input type="text" id="parentName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á" required>
                                </div>

                                <div class="form-group">
                                    <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                    <input type="tel" id="parentPhone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" required>
                                </div>

                                <button type="submit" class="submit-btn">‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤</button>
                            </form>
                        </div>

                        <div class="history-section">
                            <div class="section-title">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤</div>
                            <div class="history-list" id="historyList">
                                <div class="empty-state">
                                    <div>üì≠ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            const today = new Date().toISOString().split('T')[0];
            document.getElementById('leaveDate').value = today;

            document.getElementById('leaveForm').addEventListener('submit', handleStudentSubmit);
            loadStudentHistory();
        }

        function handleStudentSubmit(e) {
            e.preventDefault();
            
            if (!database) {
                showNotification('‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase', 'error');
                return;
            }

            const btn = e.target.querySelector('.submit-btn');
            btn.disabled = true;
            btn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';

            const requestData = {
                studentId: document.getElementById('studentId').value,
                studentName: document.getElementById('studentName').value,
                studentClass: document.getElementById('studentClass').value,
                leaveDate: document.getElementById('leaveDate').value,
                leaveTime: document.getElementById('leaveTime').value,
                returnTime: document.getElementById('returnTime').value,
                reason: document.getElementById('reason').value,
                parentName: document.getElementById('parentName').value,
                parentPhone: document.getElementById('parentPhone').value,
                status: 'pending',
                rejectReason: '',
                createdAt: new Date().toISOString(),
                username: currentUser.username
            };

            database.ref('leaveRequests').push(requestData, (error) => {
                btn.disabled = false;
                btn.innerHTML = '‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤';

                if (error) {
                    showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                } else {
                    showNotification('‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    document.getElementById('leaveForm').reset();
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('leaveDate').value = today;
                    loadStudentHistory();
                }
            });
        }

        function loadStudentHistory() {
            if (!database) return;

            const studentIdEl = document.getElementById('studentId');
            if (!studentIdEl) {
                setTimeout(loadStudentHistory, 500);
                return;
            }

            studentIdEl.addEventListener('change', updateHistory);
            
            function updateHistory() {
                const studentId = studentIdEl.value;
                if (!studentId) return;

                database.ref('leaveRequests')
                    .orderByChild('studentId')
                    .equalTo(studentId)
                    .on('value', (snapshot) => {
                        const historyList = document.getElementById('historyList');
                        const data = snapshot.val();

                        if (!data) {
                            historyList.innerHTML = `
                                <div class="empty-state">
                                    <div>üì≠ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤</div>
                                </div>
                            `;
                            return;
                        }

                        historyList.innerHTML = '';
                        Object.values(data).reverse().forEach(item => {
                            const historyHTML = `
                                <div class="history-item">
                                    <div class="history-item-header">
                                        <span class="history-item-date">${item.leaveDate}</span>
                                        <span class="status-badge status-${item.status}">${
                                            item.status === 'pending' ? '‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' :
                                            item.status === 'approved' ? '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' :
                                            '‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'
                                        }</span>
                                    </div>
                                    <div class="history-item-time">‚è∞ ${item.leaveTime}${item.returnTime ? ' - ' + item.returnTime : ''}</div>
                                    <div class="history-item-reason">üìù ${item.reason}</div>
                                    ${item.status === 'rejected' && item.rejectReason ? 
                                        `<div class="reject-reason">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${item.rejectReason}</div>` : ''}
                                </div>
                            `;
                            historyList.innerHTML += historyHTML;
                        });
                    });
            }
        }

        // ===== TEACHER PAGE =====
        function renderTeacherPage() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="container">
                    <div class="app-header">
                        <div class="header-info">
                            <div class="emoji">üë®‚Äçüè´</div>
                            <div>
                                <h2>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ${currentUser.username}</h2>
                                <p>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</p>
                            </div>
                        </div>
                        <button class="logout-btn" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                    </div>

                    <div class="teacher-dashboard">
                        <div class="stats-panel">
                            <h3 class="section-title" style="color: #333; margin-bottom: 20px;">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                            <div class="stat-card">
                                <span class="stat-number" id="statPending">0</span>
                                <span class="stat-label">‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number" id="statApproved">0</span>
                                <span class="stat-label">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number" id="statRejected">0</span>
                                <span class="stat-label">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
                            </div>
                        </div>

                        <div class="requests-panel">
                            <h3 class="section-title" style="color: #333; margin-bottom: 15px;">üìã ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                            
                            <div class="filter-bar">
                                <button class="filter-btn active" onclick="filterRequests('all')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                                <button class="filter-btn" onclick="filterRequests('pending')">‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</button>
                                <button class="filter-btn" onclick="filterRequests('approved')">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                                <button class="filter-btn" onclick="filterRequests('rejected')">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                            </div>

                            <div class="requests-list" id="requestsList">
                                <div class="empty-state">
                                    <div>üì≠ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            loadTeacherRequests();
            setInterval(loadTeacherRequests, 3000);
        }

        let currentFilter = 'all';

        function filterRequests(status) {
            currentFilter = status;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            displayRequests();
        }

        function loadTeacherRequests() {
            if (!database) return;

            database.ref('leaveRequests').on('value', (snapshot) => {
                const data = snapshot.val();
                requests = data ? Object.entries(data).map(([key, value]) => ({...value, dbKey: key})) : [];
                displayRequests();
                updateStats();
            });
        }

        function displayRequests() {
            const requestsList = document.getElementById('requestsList');
            const today = new Date().toISOString().split('T')[0];
            
            let filtered = requests.filter(req => req.leaveDate === today);
            
            if (currentFilter !== 'all') {
                filtered = filtered.filter(req => req.status === currentFilter);
            }

            if (filtered.length === 0) {
                requestsList.innerHTML = `
                    <div class="empty-state">
                        <div>üì≠ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤</div>
                    </div>
                `;
                return;
            }

            requestsList.innerHTML = filtered.map(req => `
                <div class="request-card ${req.status}">
                    <div class="request-header">
                        <div class="student-info">
                            <div class="student-name">${req.studentName}</div>
                            <div class="student-id">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß: ${req.studentId} | ‡∏ä‡∏±‡πâ‡∏ô: ${req.studentClass}</div>
                        </div>
                        <div class="status-badge status-${req.status}">${
                            req.status === 'pending' ? '‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' :
                            req.status === 'approved' ? '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' :
                            '‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'
                        }</div>
                    </div>

                    <div class="request-details">
                        <div class="detail-item">
                            <span class="detail-label">üóìÔ∏è ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
                            <span class="detail-value">${req.leaveDate}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</span>
                            <span class="detail-value">${req.leaveTime}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">üîô ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö (‡∏Ñ‡∏≤‡∏î)</span>
                            <span class="detail-value">${req.returnTime || '-'}</span>
                        </div>
                    </div>

                    <div class="detail-item" style="margin-bottom: 15px;">
                        <span class="detail-label">üìù ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</span>
                        <span class="detail-value">${req.reason}</span>
                    </div>

                    <div style="background: #f0f0f0; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid #667eea;">
                        <strong>üë®‚Äçüë©‚Äçüëß ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</strong>
                        <div style="font-size: 13px; margin-top: 5px; color: #555;">
                            <div>üìõ ${req.parentName}</div>
                            <div>üì± ${req.parentPhone}</div>
                        </div>
                    </div>

                    ${req.status === 'pending' ? `
                        <div class="request-actions">
                            <button class="action-btn approve-btn" onclick="approveRequest('${req.dbKey}')">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                            <button class="action-btn reject-btn" onclick="showRejectForm('${req.dbKey}')">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                        </div>
                    ` : ''}

                    ${req.status === 'rejected' && req.rejectReason ? `
                        <div style="background: #fff5f5; padding: 12px; border-radius: 8px; border-left: 3px solid #dc3545;">
                            <strong style="color: #dc3545;">üìå ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:</strong>
                            <div style="color: #dc3545; font-size: 13px; margin-top: 5px;">${req.rejectReason}</div>
                        </div>
                    ` : ''}

                    <div id="rejectForm-${req.dbKey}" style="display:none;"></div>
                </div>
            `).join('');
        }

        function showRejectForm(dbKey) {
            const formDiv = document.getElementById(`rejectForm-${dbKey}`);
            formDiv.innerHTML = `
                <div class="rejection-form">
                    <textarea id="rejectText-${dbKey}" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥..."></textarea>
                    <div class="rejection-actions">
                        <button class="action-btn cancel-reject-btn" onclick="cancelRejectForm('${dbKey}')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button class="action-btn confirm-reject-btn" onclick="confirmReject('${dbKey}')">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                    </div>
                </div>
            `;
            formDiv.style.display = 'block';
        }

        function cancelRejectForm(dbKey) {
            document.getElementById(`rejectForm-${dbKey}`).style.display = 'none';
        }

        function approveRequest(dbKey) {
            if (!database) return;
            
            database.ref(`leaveRequests/${dbKey}`).update({
                status: 'approved'
            }, (error) => {
                if (error) {
                    showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
                } else {
                    showNotification('‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                }
            });
        }

        function confirmReject(dbKey) {
            if (!database) return;

            const reason = document.getElementById(`rejectText-${dbKey}`).value;
            if (!reason.trim()) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'error');
                return;
            }

            database.ref(`leaveRequests/${dbKey}`).update({
                status: 'rejected',
                rejectReason: reason
            }, (error) => {
                if (error) {
                    showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
                } else {
                    showNotification('‚úÖ ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                }
            });
        }

        function updateStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayRequests = requests.filter(req => req.leaveDate === today);
            
            document.getElementById('statPending').textContent = todayRequests.filter(r => r.status === 'pending').length;
            document.getElementById('statApproved').textContent = todayRequests.filter(r => r.status === 'approved').length;
            document.getElementById('statRejected').textContent = todayRequests.filter(r => r.status === 'rejected').length;
        }

        function logout() {
            currentUser = null;
            currentRole = null;
            requests = [];
            renderLoginPage();
            showNotification('‚úÖ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        }

        // Initialize
        if (initFirebase()) {
            renderLoginPage();
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cc45cc771404f52',t:'MTc3MDgxODMyMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
